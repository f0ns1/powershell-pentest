############
#Powershell recognition system post-exploitation base script
#
############


function get_os($computerInfo){
     $os=@{}
     $os['WindowsCurrentVersion']=$computerInfo.WindowsCurrentversion
     $os['WindowsVersion']=$computerInfo.Windowsversion
     $os['OsVersion']=$computerInfo.Osversion
     $os['WindowsProductName']=$computerInfo.WindowsProductName
     return $os
}

function get_systeminfo($computerinfo){
    return $computerinfo.csname
}

function get_patchs($computerinfo){
    return $computerinfo.OSHotfixes.HotFixID
}

function get_groups_members(){
    return  (Get-LocalGroup |Select-Object "Name") | ForEach-Object -Process { $_.Name;Get-LocalGroupMember -Group $_.Name }
}

function get_procs(){
    return Get-Process | Select-Object ProcessName
}
function recon_file($psobject){
    echo "Recon Init" > recon.txt
    echo "System : " $psobject.system >> recon.txt
    echo "OS : " $psobject.os >> recon.txt
    echo "patches : " $psobject.patch >> recon.txt
    echo "ip : " $psobject.ip >> recon.txt
    echo "network : " $psobject.network >> recon.txt
    echo "user : " $psobject.user >> recon.txt
    echo "users by group : " $psobject.useradmins >>recon.txt
    echo "task : " $psobject.task >> recon.txt
    echo "procs : " $psobject.procs >> recon.txt
    echo "End recon" >> recon.txt
}
function show_data($psobject){
    echo "POST-EXPLOITATION OBJECT: "
    $psobject
    echo ""
    echo " System --> "
    $psobject.system
    echo ""
    echo " Os -->"
    
    $psobject.os 
    echo ""
    echo " id -->"

    $psobject.id
    echo ""
    echo " network -->"

    $psobject.network
    echo ""
    echo " patches -->"

    $psobject.patch
    echo ""
    echo " users -->"
    $psObject.user
    echo ""
    echo " users by group -->"

    $psobject.useradmins
    echo ""
    echo "Procs -->"

    #$psobject.procs
    echo "Recon Init" > recon.txt
    recon_file($psobject)
}
function get_task(){
    return Get-ScheduledTask | Format-List
}


function get_ip(){
    return ipconfig /all
}

function get_network(){
    return netstat -n
}

function get_info($computerinfo){
    $object.os=get_os($computerinfo)
    $object.system=get_systeminfo($computerinfo)
    $object.procs=get_procs
    $object.patch=get_patchs($computerinfo)

    $object.user=Get-LocalUser
    $object.useradmins=get_groups_members

    $object.task=get_task

    $object.network=get_network

    $object.ip=get_ip
    return $object
}

####################
#Main 
#
####################

$object=@{}
$computerinfo = Get-ComputerInfo
$object=get_info($computerinfo)
$psobject = New-Object PSCustomObject -Property $object
show_data($psobject)
